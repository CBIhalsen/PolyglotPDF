# PolyglotPDF

[![Python](https://img.shields.io/badge/python-3.8-blue.svg)](https://www.python.org/)
[![PDF](https://img.shields.io/badge/pdf-documentation-brightgreen.svg)](https://example.com)
[![LaTeX](https://img.shields.io/badge/latex-typesetting-orange.svg)](https://www.latex-project.org/)
[![Translation](https://img.shields.io/badge/translation-supported-yellow.svg)](https://example.com)
[![Math](https://img.shields.io/badge/math-formulas-red.svg)](https://example.com)
[![PyMuPDF](https://img.shields.io/badge/PyMuPDF-1.24.0-blue.svg)](https://pymupdf.readthedocs.io/)

## æ¼”ç¤º
<img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/demo.gif?raw=true" width="80%" height="40%">

## é€Ÿåº¦å°æ¯”

<img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/Figure_1.png?raw=true" width="80%" height="40%">

### [ğŸ¬ è§€çœ‹å®Œæ•´å½±ç‰‡](https://github.com/CBIhalsen/PolyglotPDF/blob/main/demo.mp4)
ç¿»è­¯APIé¸é …å·²æ–°å¢LLMsã€‚æ¨è–¦æ¨¡å‹ï¼šDoubaoã€Qwenã€deepseek v3ã€gpt4-o-miniã€‚è‰²å½©ç©ºé–“éŒ¯èª¤å¯é€éå¡«å……PDFæª”æ¡ˆçš„ç™½è‰²å€åŸŸä¾†è§£æ±ºã€‚èˆŠæœ‰çš„text to textç¿»è­¯APIå·²è¢«ç§»é™¤ã€‚

æ­¤å¤–ï¼Œæˆ‘å€‘æ­£åœ¨è€ƒæ…®æ–°å¢arXivæœå°‹åŠŸèƒ½å’ŒarXivè«–æ–‡çš„LaTeXç¿»è­¯å¾Œæ¸²æŸ“åŠŸèƒ½ã€‚

### é é¢å±•ç¤º
<div style="display: flex; margin-bottom: 20px;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page1.png?raw=true" width="40%" height="20%" style="margin-right: 20px;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page2.jpeg?raw=true" width="40%" height="20%">
</div>
<div style="display: flex;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page3.png?raw=true" width="40%" height="20%" style="margin-right: 20px;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page4.png?raw=true" width="40%" height="20%">
</div>

# ä¸­åœ‹å¤§å‹èªè¨€æ¨¡å‹APIç”³è«‹

## Doubao & Deepseek
å¾ç«å±±å¼•æ“å¹³å°ç”³è«‹ï¼š
- ç”³è«‹åœ°å€ï¼š[ç«å±±å¼•æ“-Doubao](https://www.volcengine.com/product/doubao/)
- æ”¯æ´æ¨¡å‹ï¼šDoubaoã€Deepseekç³»åˆ—æ¨¡å‹

## é€šç¾©åƒå•(Qwen)
å¾é˜¿é‡Œé›²å¹³å°ç”³è«‹ï¼š
- ç”³è«‹åœ°å€ï¼š[é˜¿é‡Œé›²-é€šç¾©åƒå•](https://cn.aliyun.com/product/tongyi?from_alibabacloud=&utm_content=se_1019997984)
- æ”¯æ´æ¨¡å‹ï¼šQwen-Maxã€Qwen-Plusç­‰ç³»åˆ—æ¨¡å‹

## æ¦‚è¿°
PolyglotPDFæ˜¯ä¸€æ¬¾ä½¿ç”¨ç‰¹æ®ŠæŠ€è¡“ï¼Œèƒ½å¤ è¶…é«˜é€Ÿè­˜åˆ¥PDFæ–‡ä»¶ä¸­æ–‡å­—ã€è¡¨æ ¼ã€æ•¸å­¸å…¬å¼çš„å…ˆé€²PDFè™•ç†å·¥å…·ã€‚é€šå¸¸èƒ½åœ¨1ç§’å…§å®Œæˆè™•ç†ï¼Œä¸¦æ”¯æ´OCRåŠŸèƒ½å’Œå®Œæ•´çš„ç‰ˆé¢ä¿æŒç¿»è­¯åŠŸèƒ½ã€‚æ•´ä»½æ–‡ä»¶çš„ç¿»è­¯é€šå¸¸èƒ½åœ¨10ç§’å…§å®Œæˆï¼ˆé€Ÿåº¦ä¾ç¿»è­¯APIæä¾›å•†è€Œç•°ï¼‰ã€‚

## ä¸»è¦ç‰¹é»
- **è¶…é«˜é€Ÿè­˜åˆ¥**ï¼šç´„1ç§’å…§å®ŒæˆPDFä¸­æ–‡å­—ã€è¡¨æ ¼ã€æ•¸å­¸å…¬å¼çš„è™•ç†
- **ç‰ˆé¢ä¿æŒç¿»è­¯**ï¼šç¿»è­¯æ™‚å®Œæ•´ä¿æŒåŸæ–‡ä»¶çš„æ ¼å¼
- **OCRæ”¯æ´**ï¼šé«˜æ•ˆè™•ç†æƒæç‰ˆæ–‡ä»¶
- **æ–‡å­—åŸºç¤PDF**ï¼šç„¡éœ€GPU
- **å¿«é€Ÿç¿»è­¯**ï¼šç´„10ç§’å®ŒæˆPDFæ•´é«”ç¿»è­¯
- **éˆæ´»APIæ•´åˆ**ï¼šå¯èˆ‡å„ç¨®ç¿»è­¯æœå‹™æä¾›å•†é€£æ¥
- **ç¶²é åŸºç¤æ¯”è¼ƒä»‹é¢**ï¼šæ”¯æ´åŸæ–‡èˆ‡è­¯æ–‡ä¸¦åˆ—æ¯”è¼ƒ
- **å¼·åŒ–OCRåŠŸèƒ½**ï¼šæ›´æº–ç¢ºçš„æ–‡å­—è­˜åˆ¥å’Œè™•ç†èƒ½åŠ›
- **é›¢ç·šç¿»è­¯æ”¯æ´**ï¼šä½¿ç”¨å°å‹ç¿»è­¯æ¨¡å‹

## å®‰è£èˆ‡è¨­å®š

### ä½¿ç”¨æ–¹æ³•ä¹‹ä¸€æ˜¯å®‰è£è©²åº«ï¼š

```bash
pip install EbookTranslator
```

åŸºæœ¬ç”¨æ³•ï¼š

```bash
EbookTranslator your_file.pdf
```

å¸¶åƒæ•¸ä½¿ç”¨ï¼š

```bash
EbookTranslator your_file.pdf -o en -t zh -b 1 -e 10 -c /path/to/config.json -d 300
```

#### åœ¨ Python ä¸­ä½¿ç”¨

```python
from EbookTranslator import main_function

translator = main_function(
    pdf_path="your_file.pdf",
    original_language="en",
    target_language="zh",
    bn=1,
    en=10,
    config_path="/path/to/config.json",
    DPI=300
)
translator.main()
```

## åƒæ•¸èªªæ˜

| åƒæ•¸ | å‘½ä»¤è¡Œé¸é … | æè¿° | é»˜èªå€¼ |
|-----------|---------------------|-------------|---------------|
| `pdf_path` | ä½ç½®åƒæ•¸ | PDF æ–‡ä»¶è·¯å¾‘ | å¿…å¡« |
| `original_language` | `-o, --original` | æºèªè¨€ | `auto` |
| `target_language` | `-t, --target` | ç›®æ¨™èªè¨€ | `zh` |
| `bn` | `-b, --begin` | èµ·å§‹é ç¢¼ | `1` |
| `en` | `-e, --end` | çµæŸé ç¢¼ | æ–‡æª”çš„æœ€å¾Œä¸€é  |
| `config_path` | `-c, --config` | é…ç½®æ–‡ä»¶è·¯å¾‘ | ç•¶å‰å·¥ä½œç›®éŒ„ä¸‹çš„ `config.json` |
| `DPI` | `-d, --dpi` | OCR æ¨¡å¼çš„ DPI | `72` |

#### é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶æ˜¯ä¸€å€‹ JSON æ–‡ä»¶ï¼Œé»˜èªä½æ–¼ç•¶å‰å·¥ä½œç›®éŒ„ä¸‹çš„ `config.json`ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œç¨‹åºå°‡ä½¿ç”¨å…§ç½®çš„é»˜èªè¨­ç½®ã€‚

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```json
{
  "count": 4,
  "PPC": 20,
  "translation_services": {
    "Doubao": {
      "auth_key": "",
      "model_name": ""
    },
    "Qwen": {
      "auth_key": "",
      "model_name": "qwen-plus"
    },
    "deepl": {
      "auth_key": ""
    },
    "deepseek": {
      "auth_key": "",
      "model_name": "ep-20250218224909-gps4n"
    },
    "openai": {
      "auth_key": "",
      "model_name": "gpt-4o-mini"
    },
    "youdao": {
      "app_key": "",
      "app_secret": ""
    }
  },
  "ocr_services": {
    "tesseract": {
      "path": "C:\\Program Files\\Tesseract-OCR\\tesseract.exe"
    }
  },
  "default_services": {
    "ocr_model": false,
    "line_model": false,
    "Enable_translation": true,
    "Translation_api": "openai"
  }
}
```

#### é…ç½®é¸é …

- `translation_service`: ç¿»è­¯æœå‹™æä¾›å•†ï¼ˆä¾‹å¦‚ "google", "deepl", "baidu"ï¼‰
- `api_key`: ç¿»è­¯ API å¯†é‘°ï¼ˆå¦‚æœéœ€è¦ï¼‰
- `translation_mode`: ç¿»è­¯æ¨¡å¼ï¼Œ"online" æˆ– "offline"
- `ocr_enabled`: æ˜¯å¦å•Ÿç”¨ OCR è­˜åˆ¥
- `tesseract_path`: Tesseract OCR å¼•æ“è·¯å¾‘ï¼ˆå¦‚æœæœªæ·»åŠ åˆ°ç³»çµ± PATHï¼‰
- `output_dir`: è¼¸å‡ºç›®éŒ„
- `language_codes`: èªè¨€ä»£ç¢¼æ˜ å°„
- `font_mapping`: ä¸åŒèªè¨€å°æ‡‰çš„å­—é«”

#### è¼¸å‡º

ç¿»è­¯å¾Œçš„ PDF æ–‡ä»¶å°‡ä¿å­˜åœ¨ `output_dir` æŒ‡å®šçš„ç›®éŒ„ä¸­ï¼ˆé»˜èªæ˜¯ç•¶å‰å·¥ä½œç›®éŒ„ä¸‹çš„ `target` æ–‡ä»¶å¤¾ï¼‰ã€‚

## è¨±å¯

MIT

## ä½¿ç”¨å‹å¥½ UI ä»‹é¢çš„æ–¹æ³•

1. è¤‡è£½å„²å­˜åº«ï¼š
```bash
git clone https://github.com/CBIhalsen/Polyglotpdf.git
cd Polyglotpdf
```

2. å®‰è£ç›¸ä¾å¥—ä»¶ï¼š
```bash
pip install -r requirements.txt
```

3. åœ¨config.jsonä¸­è¨­å®šAPIé‡‘é‘°ã€‚ä¸å»ºè­°ä½¿ç”¨alicloudç¿»è­¯APIã€‚

4. åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ï¼š
```bash
python app.py
```

5. å­˜å–ç¶²é ä»‹é¢ï¼š
åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ `http://127.0.0.1:8000`

## ç’°å¢ƒéœ€æ±‚
- Python 3.8+
- deepl==1.17.0
- Flask==2.0.1
- Flask-Cors==5.0.0
- langdetect==1.0.9
- Pillow==10.2.0
- PyMuPDF==1.24.0
- pytesseract==0.3.10
- requests==2.31.0
- Werkzeug==2.0.1

## è‡´è¬
æœ¬å°ˆæ¡ˆå—ç›Šæ–¼PyMuPDFå¼·å¤§çš„PDFè™•ç†å’Œç‰ˆé¢ä¿æŒåŠŸèƒ½ã€‚

## æœªä¾†æ”¹é€²è¨ˆåŠƒ
- PDFèŠå¤©åŠŸèƒ½
- å­¸è¡“PDFæœå°‹æ•´åˆ
- é€²ä¸€æ­¥æå‡è™•ç†é€Ÿåº¦

### å¾…ä¿®æ­£å•é¡Œ
- **å•é¡Œæè¿°**ï¼šæ‡‰ç”¨ç¨‹å¼é‡æ–°ç·¨è¼¯æ™‚çš„éŒ¯èª¤ï¼š`code=4: only Gray, RGB, and CMYK colorspaces supported`
- **ç¾è±¡**ï¼šç·¨è¼¯æ–‡å­—å€å¡Šæ™‚å‡ºç¾ä¸æ”¯æ´çš„è‰²å½©ç©ºé–“
- **ç›®å‰è§£æ±ºæ–¹æ¡ˆ**ï¼šè·³éåŒ…å«ä¸æ”¯æ´è‰²å½©ç©ºé–“çš„æ–‡å­—å€å¡Š
- **è§£æ±ºæ–¹å‘**ï¼šä½¿ç”¨OCRæ¨¡å¼è™•ç†åŒ…å«ä¸æ”¯æ´è‰²å½©ç©ºé–“çš„æ•´å€‹é é¢
- **é‡ç¾ç¯„ä¾‹**ï¼š[æŸ¥çœ‹ä¸æ”¯æ´è‰²å½©ç©ºé–“çš„PDFç¯„ä¾‹](https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/colorspace_issue_sample.pdf)

### å­—å‹æœ€ä½³åŒ–
ç›®å‰åœ¨`main.py`çš„`start`å‡½æ•¸ä¸­ï¼Œä½¿ç”¨é è¨­å­—å‹è¨­å®šæ’å…¥æ–‡å­—ï¼š
```python
# ç›®å‰è¨­å®š
css=f"* {{font-family:{get_font_by_language(self.target_language)};font-size:auto;color: #111111 ;font-weight:normal;}}"
```

å­—å‹é¡¯ç¤ºå¯é€éä»¥ä¸‹æ–¹å¼æœ€ä½³åŒ–ï¼š

1. **ä¿®æ”¹é è¨­å­—å‹è¨­å®š**
```python
# è‡ªè¨‚å­—å‹æ¨£å¼
css=f"""* {{
    font-family: {get_font_by_language(self.target_language)};
    font-size: auto;
    color: #111111;
    font-weight: normal;
    letter-spacing: 0.5px;  # èª¿æ•´å­—è·
    line-height: 1.5;      # èª¿æ•´è¡Œé«˜
}}"""
```

2. **åµŒå…¥è‡ªè¨‚å­—å‹**
å¯é€éä»¥ä¸‹æ­¥é©ŸåµŒå…¥è‡ªè¨‚å­—å‹ï¼š
- å°‡å­—å‹æª”æ¡ˆï¼ˆ.ttfã€.otfç­‰ï¼‰æ”¾ç½®åœ¨å°ˆæ¡ˆçš„`fonts`ç›®éŒ„ä¸­
- åœ¨CSSä¸­ä½¿ç”¨`@font-face`å®£å‘Šè‡ªè¨‚å­—å‹
```python
css=f"""
@font-face {{
    font-family: 'CustomFont';
    src: url('fonts/your-font.ttf') format('truetype');
}}
* {{
    font-family: 'CustomFont', {get_font_by_language(self.target_language)};
    font-size: auto;
    font-weight: normal;
}}
"""
```

### åŸºæœ¬åŸç†
æœ¬å°ˆæ¡ˆæ¡ç”¨èˆ‡Adobe Acrobat DCçš„PDFç·¨è¼¯é¡ä¼¼çš„åŸºæœ¬åŸç†ï¼Œä½¿ç”¨PyMuPDFè­˜åˆ¥å’Œè™•ç†PDFæ–‡å­—å€å¡Šï¼š

- **æ ¸å¿ƒè™•ç†æµç¨‹**ï¼š
```python
# å¾é é¢å–å¾—æ–‡å­—å€å¡Š
blocks = page.get_text("dict")["blocks"]

# è™•ç†æ¯å€‹æ–‡å­—å€å¡Š
for block in blocks:
    if block.get("type") == 0:  # æ–‡å­—å€å¡Š
        bbox = block["bbox"]     # å–å¾—æ–‡å­—å€å¡Šçš„é‚Šç•Œæ¡†
        text = ""
        font_info = None
        # æ”¶é›†æ–‡å­—å’Œå­—å‹è³‡è¨Š
        for line in block["lines"]:
            for span in line["spans"]:
                text += span["text"] + " "
```
é€™ç¨®æ–¹å¼ç›´æ¥è™•ç†PDFæ–‡å­—å€å¡Šï¼Œåœ¨ä¿æŒåŸå§‹ç‰ˆé¢çš„åŒæ™‚ï¼Œå¯¦ç¾é«˜æ•ˆçš„æ–‡å­—æ“·å–å’Œä¿®æ”¹ã€‚

- **æŠ€è¡“é¸æ“‡**ï¼š
  - ä½¿ç”¨PyMuPDFé€²è¡ŒPDFè§£æå’Œç·¨è¼¯
  - å°ˆæ³¨æ–¼æ–‡å­—è™•ç†ï¼Œé¿å…å•é¡Œè¤‡é›œåŒ–
  - ä¸é€²è¡Œè¤‡é›œçš„AIè­˜åˆ¥ï¼Œå¦‚æ•¸å­¸å…¬å¼ã€è¡¨æ ¼ã€é é¢é‡æ§‹

- **é¿å…è¤‡é›œè™•ç†çš„åŸå› **ï¼š
  - æ•¸å­¸å…¬å¼ã€è¡¨æ ¼ã€PDFé é¢é‡æ§‹çš„AIè­˜åˆ¥å­˜åœ¨åš´é‡çš„æ•ˆèƒ½ç“¶é ¸
  - è¤‡é›œçš„AIè™•ç†è¨ˆç®—æˆæœ¬é«˜æ˜‚
  - è™•ç†æ™‚é–“å¤§å¹…å¢åŠ ï¼ˆå¯èƒ½éœ€è¦æ•¸åç§’ä»¥ä¸Šï¼‰
  - é›£ä»¥åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­é€²è¡Œå¤§è¦æ¨¡ä½æˆæœ¬éƒ¨ç½²
  - ä¸é©åˆç·šä¸Šæœå‹™çš„å¿«é€Ÿå›æ‡‰

- **å°ˆæ¡ˆå®šä½**ï¼š
  - ä¸»è¦ç›®çš„æ˜¯ä¿æŒç‰ˆé¢çš„PDFæª”æ¡ˆç¿»è­¯
  - æä¾›PDF AIè¼”åŠ©é–±è®€çš„é«˜æ•ˆå¯¦ç¾æ–¹å¼
  - è¿½æ±‚æœ€ä½³æ•ˆèƒ½å’Œæˆæœ¬æ¯”

- **æ•ˆèƒ½è¡¨ç¾**ï¼š
  - PolyglotPDF APIæœå‹™å›æ‡‰æ™‚é–“ï¼šç´„1ç§’/é 
  - ä½è¨ˆç®—è³‡æºæ¶ˆè€—ï¼Œå¯æ“´å±•éƒ¨ç½²
  - æˆæœ¬æ•ˆç›Šé«˜ï¼Œé©åˆå•†æ¥­ä½¿ç”¨
