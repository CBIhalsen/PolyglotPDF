æ³¨ï¼š å¯¹äºpdfè¿™ç§æ£˜æ‰‹çš„æ–‡ä»¶å¤„ç†ï¼Œå¯¹äºæ–‡å­—ç‰ˆpdfçš„æœ€ä¼˜è§£ï¼šå‚è€ƒå¼€æºé¡¹ç›®mupdfé‡æ„blockè¯†åˆ«ç®—æ³•åªéœ€è¦è¾¾åˆ°Adobe Acrobat Dcç²¾åº¦å³å¯ï¼Œä¸è¦èˆè¿‘æ±‚è¿œä½¿ç”¨ocræ‰«ææ–‡å­—ç‰ˆpdfã€‚ ä½¿ç”¨aiæ¨¡å‹å»ç†è§£pdfå¸ƒå±€æœªæ¥æˆæœ¬ç»å¯¹ä¼šé«˜äºä½¿ç”¨gpt4o miniè¿™ç±»ä»·æ ¼ï¼ å¯¹äºpdfç§å…¬å¼è¯†åˆ«å‡ºè¦ä¹ˆä¸å¤„ç†ï¼Œè¦ä¹ˆé€šè¿‡å­—ä½“æ–‡ä»¶åç§°å’Œå¯¹åº”unicodeå€¼è¿›è¡Œæ˜ å°„ã€‚ ocræ‰«ææ–‡å­—ç‰ˆpdfç›¸å½“æ„šè ¢
# PolyglotPDF

[![Python](https://img.shields.io/badge/python-3.8-blue.svg)](https://www.python.org/)
[![PDF](https://img.shields.io/badge/pdf-documentation-brightgreen.svg)](https://example.com)
[![LaTeX](https://img.shields.io/badge/latex-typesetting-orange.svg)](https://www.latex-project.org/)
[![Translation](https://img.shields.io/badge/translation-supported-yellow.svg)](https://example.com)
[![Math](https://img.shields.io/badge/math-formulas-red.svg)](https://example.com)
[![PyMuPDF](https://img.shields.io/badge/PyMuPDF-1.24.0-blue.svg)](https://pymupdf.readthedocs.io/)

## Demo
<img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/demo.gif?raw=true" width="80%" height="40%">

### [ğŸ¬ Watch Full Video](https://github.com/CBIhalsen/PolyglotPDF/blob/main/demo.mp4)
å·²ç»åŠ å…¥llmsä½œä¸ºç¿»è¯‘apiçš„é€‰æ‹©ï¼Œå»ºè®®é€‰æ‹©ï¼šDoubao ,Qwen ,deepseek v3 ,gpt4-o-miniã€‚è‰²å½©ç©ºé—´é”™è¯¯å¯ä»¥é€šè¿‡å¡«å……PDFæ–‡ä»¶ä¸­çš„ç™½è‰²åŒºåŸŸæ¥è§£å†³ã€‚ å¤è€text to textç¿»è¯‘apiå·²åˆ é™¤

å¦å¤–ï¼Œè€ƒè™‘æ·»åŠ arxivæœç´¢åŠŸèƒ½åŠå¯¹arxivè®ºæ–‡è¿›è¡Œlatexç¿»è¯‘åæ¸²æŸ“ã€‚

### é¡µé¢å±•ç¤º
<div style="display: flex; margin-bottom: 20px;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page1.png?raw=true" width="40%" height="20%" style="margin-right: 20px;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page2.jpeg?raw=true" width="40%" height="20%">
</div>
<div style="display: flex;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page3.png?raw=true" width="40%" height="20%" style="margin-right: 20px;">
    <img src="https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/page4.png?raw=true" width="40%" height="20%">
</div>

# å›½å†…å¤§è¯­è¨€æ¨¡å‹APIç”³è¯·

## Doubao & Deepseek
é€šè¿‡ç«å±±å¼•æ“å¹³å°ç”³è¯·:
- ç”³è¯·åœ°å€: [ç«å±±å¼•æ“-è±†åŒ…](https://www.volcengine.com/product/doubao/)
- æ”¯æŒæ¨¡å‹: è±†åŒ…(Doubao)ã€Deepseekç³»åˆ—æ¨¡å‹

## é€šä¹‰åƒé—®(Qwen)
é€šè¿‡é˜¿é‡Œäº‘å¹³å°ç”³è¯·:
- ç”³è¯·åœ°å€: [é˜¿é‡Œäº‘-é€šä¹‰åƒé—®](https://cn.aliyun.com/product/tongyi?from_alibabacloud=&utm_content=se_1019997984) 
- æ”¯æŒæ¨¡å‹: Qwen-Maxã€Qwen-Plusç­‰ç³»åˆ—æ¨¡å‹


## æ¦‚è¿°
PolyglotPDF æ˜¯ä¸€æ¬¾å…ˆè¿›çš„ PDF å¤„ç†å·¥å…·ï¼Œé‡‡ç”¨ç‰¹æ®ŠæŠ€æœ¯å®ç°å¯¹ PDF æ–‡æ¡£ä¸­çš„æ–‡å­—ã€è¡¨æ ¼å’Œå…¬å¼çš„è¶…å¿«é€Ÿè¯†åˆ«ï¼Œé€šå¸¸ä»…éœ€ 1 ç§’å³å¯å®Œæˆå¤„ç†ã€‚å®ƒæ”¯æŒ OCR åŠŸèƒ½å’Œå®Œç¾ä¿ç•™ç‰ˆé¢çš„ç¿»è¯‘åŠŸèƒ½ï¼Œæ•´ç¯‡æ–‡æ¡£çš„ç¿»è¯‘é€šå¸¸å¯åœ¨ 10 ç§’å†…å®Œæˆï¼ˆå…·ä½“é€Ÿåº¦å–å†³äºç¿»è¯‘ API æœåŠ¡å•†ï¼‰ã€‚

## ä¸»è¦ç‰¹ç‚¹
- **è¶…å¿«è¯†åˆ«**ï¼šåœ¨çº¦ 1 ç§’å†…å®Œæˆå¯¹ PDF ä¸­æ–‡å­—ã€è¡¨æ ¼å’Œå…¬å¼çš„å¤„ç†
- **ä¿ç•™ç‰ˆé¢ç¿»è¯‘**ï¼šç¿»è¯‘è¿‡ç¨‹ä¸­å®Œæ•´ä¿æŒåŸæ–‡æ¡£çš„æ’ç‰ˆæ ¼å¼
- **OCR æ”¯æŒ**ï¼šé«˜æ•ˆå¤„ç†æ‰«æç‰ˆæ–‡æ¡£
- **åŸºäºæ–‡æœ¬çš„ PDF**ï¼šä¸éœ€è¦GPU
- **å¿«é€Ÿç¿»è¯‘**ï¼šçº¦ 10 ç§’å†…å®Œæˆæ•´ä¸ª PDF çš„ç¿»è¯‘
- **çµæ´»çš„ API é›†æˆ**ï¼šå¯å¯¹æ¥å„ç§ç¿»è¯‘æœåŠ¡æä¾›å•†
- **ç½‘é¡µå¯¹æ¯”ç•Œé¢**ï¼šæ”¯æŒåŸæ–‡ä¸è¯‘æ–‡çš„å¹¶æ’å¯¹æ¯”
- **å¢å¼ºçš„ OCR åŠŸèƒ½**ï¼šæä¾›æ›´å‡†ç¡®çš„æ–‡æœ¬è¯†åˆ«å’Œå¤„ç†èƒ½åŠ›
- **æ”¯æŒç¦»çº¿ç¿»è¯‘**ï¼šä½¿ç”¨è¾ƒå°ç¿»è¯‘æ¨¡å‹

## å®‰è£…å’Œè®¾ç½®

<details>
  <summary>æ ‡å‡†å®‰è£…</summary>

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/CBIhalsen/Polyglotpdf.git
cd polyglotpdf
```

2. å®‰è£…ä¾èµ–åŒ…ï¼š
```bash
pip install -r requirements.txt
```
3. åœ¨config.jsonå†…é…ç½®APIå¯†é’¥ï¼Œä¸å»ºè®®ä½¿ç”¨alicloudç¿»è¯‘API.

4. è¿è¡Œåº”ç”¨ï¼š
```bash
python app.py
```

5. è®¿é—®ç½‘é¡µç•Œé¢ï¼š
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://127.0.0.1:8000`
</details>

<details>
  <summary>Docker å®‰è£…</summary>

## å®‰è£…å‡†å¤‡

```bash
# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p config fonts static/original static/target static/merged_pdf

# åˆ›å»ºé…ç½®æ–‡ä»¶
nano config/config.json    # æˆ–ä½¿ç”¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨
# å¤åˆ¶é¡¹ç›®ä¸­çš„é…ç½®æ¨¡æ¿åˆ°è¯¥æ–‡ä»¶
# æ³¨æ„å¡«å†™æ‚¨çš„APIå¯†é’¥ç­‰é…ç½®ä¿¡æ¯

# è®¾ç½®æƒé™
chmod -R 755 config fonts static
```

## å¿«é€Ÿå¯åŠ¨

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‹‰å–å¹¶è¿è¡Œ PolyglotPDF Docker é•œåƒï¼š

```bash
# æ‹‰å–é•œåƒ
docker pull 2207397265/polyglotpdf:latest

# è¿è¡Œå®¹å™¨
docker run -d -p 12226:12226 --name polyglotpdf \
  -v ./config/config.json:/app/config.json \
  -v ./fonts:/app/fonts \
  -v ./static/original:/app/static/original \
  -v ./static/target:/app/static/target \
  -v ./static/merged_pdf:/app/static/merged_pdf \
  2207397265/polyglotpdf:latest
```

## è®¿é—®åº”ç”¨

å®¹å™¨å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š
```
http://localhost:12226
```

## ä½¿ç”¨ Docker Compose

åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š

```yaml
version: '3'
services:
  polyglotpdf:
    image: 2207397265/polyglotpdf:latest
    ports:
      - "12226:12226"
    volumes:
      - ./config/config.json:/app/config.json # é…ç½®æ–‡ä»¶
      - ./fonts:/app/fonts # å­—ä½“æ–‡ä»¶
      - ./static/original:/app/static/original # åŸå§‹PDF
      - ./static/target:/app/static/target # ç¿»è¯‘åPDF
      - ./static/merged_pdf:/app/static/merged_pdf # åˆå¹¶PDF
    restart: unless-stopped
```

ç„¶åè¿è¡Œï¼š

```bash
docker-compose up -d
```
## å¸¸ç”¨ Docker å‘½ä»¤

```bash
# åœæ­¢å®¹å™¨
docker stop polyglotpdf

# é‡å¯å®¹å™¨
docker restart polyglotpdf

# æŸ¥çœ‹æ—¥å¿—
docker logs polyglotpdf
```
</details>



## ç¯å¢ƒè¦æ±‚
- Python 3.8+
- deepl==1.17.0
- Flask==2.0.1
- Flask-Cors==5.0.0
- langdetect==1.0.9
- Pillow==10.2.0
- PyMuPDF==1.24.0
- pytesseract==0.3.10
- requests==2.31.0
- tiktoken==0.6.0
- Werkzeug==2.0.1

## è‡´è°¢
æœ¬é¡¹ç›®å¾—ç›Šäº PyMuPDF å¼ºå¤§çš„ PDF å¤„ç†å’Œç‰ˆé¢ä¿æŒåŠŸèƒ½ã€‚

## å³å°†æ¨å‡ºçš„æ”¹è¿›
- PDF èŠå¤©åŠŸèƒ½
- å­¦æœ¯ PDF æœç´¢é›†æˆ
- è¿›ä¸€æ­¥æå‡å¤„ç†é€Ÿåº¦

### å¾…ä¿®å¤é—®é¢˜
- **é—®é¢˜æè¿°**ï¼šåº”ç”¨é‡ç¼–è¾‘æ—¶å‘ç”Ÿé”™è¯¯: `code=4: only Gray, RGB, and CMYK colorspaces supported`
- **ç°è±¡**ï¼šæ–‡æœ¬å—åº”ç”¨ç¼–è¾‘æ—¶é‡åˆ°ä¸æ”¯æŒçš„è‰²å½©ç©ºé—´
- **å½“å‰è§£å†³æ–¹æ¡ˆ**ï¼šé‡åˆ°ä¸æ”¯æŒçš„è‰²å½©ç©ºé—´æ—¶è·³è¿‡è¯¥æ–‡æœ¬å—
- **å¾…è§£å†³æ€è·¯**ï¼šå¯¹äºåŒ…å«ä¸æ”¯æŒè‰²å½©ç©ºé—´çš„é¡µé¢ï¼Œæ•´é¡µåˆ‡æ¢è‡³OCRæ¨¡å¼å¤„ç†
- **å¤ç°ç¤ºä¾‹**ï¼š[æŸ¥çœ‹ä¸æ”¯æŒè‰²å½©ç©ºé—´çš„PDFæ ·ä¾‹](https://github.com/CBIhalsen/PolyglotPDF/blob/main/static/colorspace_issue_sample.pdf)




### å­—ä½“ä¼˜åŒ–
å½“å‰åœ¨ `main.py` çš„ `start` å‡½æ•°ä¸­ï¼Œæ–‡æœ¬æ’å…¥ä½¿ç”¨äº†é»˜è®¤å­—ä½“é…ç½®ï¼š
```python
# å½“å‰é…ç½®
css=f"* {{font-family:{get_font_by_language(self.target_language)};font-size:auto;color: #111111 ;font-weight:normal;}}"
```

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–å­—ä½“æ˜¾ç¤ºï¼š

1. **ä¿®æ”¹é»˜è®¤å­—ä½“é…ç½®**
```python
# è‡ªå®šä¹‰å­—ä½“æ ·å¼
css=f"""* {{
    font-family: {get_font_by_language(self.target_language)};
    font-size: auto;
    color: #111111;
    font-weight: normal;
    letter-spacing: 0.5px;  # è°ƒæ•´å­—é—´è·
    line-height: 1.5;      # è°ƒæ•´è¡Œé«˜
}}"""
```

2. **åµŒå…¥è‡ªå®šä¹‰å­—ä½“**
ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤åµŒå…¥è‡ªå®šä¹‰å­—ä½“ï¼š
- å°†å­—ä½“æ–‡ä»¶ï¼ˆå¦‚.ttfï¼Œ.otfï¼‰æ”¾ç½®åœ¨é¡¹ç›®çš„ `fonts` ç›®å½•ä¸‹
- åœ¨CSSä¸­ä½¿ç”¨ `@font-face` å£°æ˜è‡ªå®šä¹‰å­—ä½“
```python
css=f"""
@font-face {{
    font-family: 'CustomFont';
    src: url('fonts/your-font.ttf') format('truetype');
}}
* {{
    font-family: 'CustomFont', {get_font_by_language(self.target_language)};
    font-size: auto;
    font-weight: normal;
}}
"""
```

### åŸºæœ¬åŸç†
æœ¬é¡¹ç›®é‡‡ç”¨ä¸ Adobe Acrobat DC ç¼–è¾‘ PDF ç±»ä¼¼çš„åŸºæœ¬åŸç†ï¼ŒåŸºäº PyMuPDF è¯†åˆ«å’Œå¤„ç† PDF æ–‡æœ¬å—ï¼š

- **æ ¸å¿ƒå¤„ç†æµç¨‹**ï¼š
```python
# è·å–é¡µé¢ä¸­çš„æ–‡æœ¬å—
blocks = page.get_text("dict")["blocks"]

# éå†å¤„ç†æ¯ä¸ªæ–‡æœ¬å—
for block in blocks:
    if block.get("type") == 0:  # æ–‡æœ¬å—
        bbox = block["bbox"]     # è·å–æ–‡æœ¬å—è¾¹ç•Œæ¡†
        text = ""
        font_info = None
        # æ”¶é›†æ–‡æœ¬å’Œå­—ä½“ä¿¡æ¯
        for line in block["lines"]:
            for span in line["spans"]:
                text += span["text"] + " "
```
è¿™ç§æ–¹å¼ç›´æ¥å¤„ç† PDF æ–‡æœ¬å—ï¼Œä¿æŒåŸæœ‰å¸ƒå±€ä¸å˜ï¼Œå®ç°é«˜æ•ˆçš„æ–‡æœ¬æå–å’Œä¿®æ”¹ã€‚

- **æŠ€æœ¯é€‰æ‹©**ï¼š
  - ä½¿ç”¨ PyMuPDF è¿›è¡Œ PDF è§£æå’Œç¼–è¾‘
  - ä¸“æ³¨äºæ–‡æœ¬å¤„ç†ï¼Œé¿å…å¤æ‚åŒ–é—®é¢˜
  - ä¸è¿›è¡Œ AI è¯†åˆ«å…¬å¼ã€è¡¨æ ¼æˆ–é¡µé¢é‡ç»„ç­‰å¤æ‚æ“ä½œ

- **ä¸ºä»€ä¹ˆé¿å…å¤æ‚å¤„ç†**ï¼š
  - AI è¯†åˆ«å…¬å¼ã€è¡¨æ ¼å’Œé‡ç»„ PDF é¡µé¢çš„æ–¹å¼å­˜åœ¨ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆ
  - å¤æ‚çš„ AI å¤„ç†å¯¼è‡´è®¡ç®—æˆæœ¬é«˜æ˜‚
  - å¤„ç†æ—¶é—´æ˜¾è‘—å¢åŠ ï¼ˆå¯èƒ½éœ€è¦æ•°åç§’ç”šè‡³æ›´é•¿ï¼‰
  - éš¾ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¤§è§„æ¨¡ä½æˆæœ¬éƒ¨ç½²
  - ä¸é€‚åˆéœ€è¦å¿«é€Ÿå“åº”çš„åœ¨çº¿æœåŠ¡

- **é¡¹ç›®å®šä½**ï¼š
  - ä¸»è¦ç”¨äºä¿ç•™å¸ƒå±€çš„ PDF æ–‡ä»¶ç¿»è¯‘
  - ä¸º AI è¾…åŠ©é˜…è¯» PDF æä¾›é«˜æ•ˆå®ç°æ–¹å¼
  - è¿½æ±‚æœ€ä½³æ€§èƒ½ä»·æ ¼æ¯”

- **æ€§èƒ½è¡¨ç°**ï¼š
  - PolyglotPDF API æœåŠ¡å“åº”æ—¶é—´ï¼šçº¦ 1 ç§’/é¡µ
  - ä½è®¡ç®—èµ„æºæ¶ˆè€—ï¼Œé€‚åˆè§„æ¨¡åŒ–éƒ¨ç½²
  - æˆæœ¬æ•ˆç›Šé«˜ï¼Œé€‚åˆå•†ä¸šåº”ç”¨

